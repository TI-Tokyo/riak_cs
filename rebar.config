%% -*- erlang -*-
{minimum_otp_vsn, "22.0"}.

{erl_opts, [ debug_info
           , warnings_as_errors
           , {nowarn_deprecated_function, [ {gen_fsm, start_link, 3}
                                          , {gen_fsm, start_link, 4}
                                          , {gen_fsm, send_event, 2}
                                          , {gen_fsm, send_all_state_event, 2}
                                          , {gen_fsm, sync_send_event, 3}
                                          , {gen_fsm, sync_send_all_state_event, 3}
                                          , {gen_fsm, reply, 2}
                                          ]}
           , {parse_transform, lager_transform}
           ]
}.

{project_plugins, [ {rebar3_cuttlefish, {git, "https://github.com/hmmr/rebar3_cuttlefish", {tag, "2.1.1"}}}
                  ]
}.

{deps, [ {getopt, ".*", {git, "git://github.com/jcomellas/getopt.git", {tag, "v1.0.2"}}}
       , {webmachine, ".*", {git, "git://github.com/webmachine/webmachine.git", {tag, "1.11.1"}}}
       , {riakc, ".*", {git, "git://github.com/basho/riak-erlang-client", {tag, "riak_kv-3.0.2"}}}
       , {uuid, ".*", {git, "git://github.com/okeuday/uuid.git", {tag, "v2.0.1"}}}
       , {poolboy, "0.8.*", {git, "git://github.com/basho/poolboy", {tag, "riak_kv-3.0.0"}}}
       , {exometer_core, ".*", {git, "git://github.com/Feuerlabs/exometer_core", {tag, "v1.5.7"}}}
       , {cluster_info, ".*", {git, "git://github.com/basho/cluster_info", {tag, "2.1.0"}}}
       , {xmerl, ".*", {git, "git://github.com/hmmr/xmerl", {tag, "0.1.2"}}}
       , {erlcloud, ".*", {git, "git://github.com/erlcloud/erlcloud.git", {tag, "3.5.2"}}}
       , {riak_repl_pb_api,".*", {git,"git://github.com/hmmr/riak_repl_pb_api.git", {tag, "riak_kv-3.0.2"}}}
       , {riak_cs_multibag,".*", {git,"git://github.com/hmmr/riak_cs_multibag.git", {tag, "riak_kv-3.0.2"}}}
       , {parse_trans, "3.3.0"}
       , {lager_syslog, {git, "git://github.com/basho/lager_syslog.git", {tag, "3.1.0"}}}
       ]
}.


{relx, [ {release, {'riak-cs', "2.2"},
          [ sasl
          , riak_cs
          ]
         }
       , {dev_mode, false}
       , {overlay, [ {template, "rel/files/advanced.config", "etc/advanced.config"}
                   , {template, "rel/files/riak-cs-access", "bin/riak-cs-access"}
                   , {template, "rel/files/riak-cs-admin", "bin/riak-cs-admin"}
                   , {template, "rel/files/riak-cs-debug", "bin/riak-cs-debug"}
                   , {template, "rel/files/riak-cs-gc", "bin/riak-cs-gc"}
                   , {template, "rel/files/riak-cs-multibag", "bin/riak-cs-multibag"}
                   , {template, "rel/files/riak-cs-stanchion", "bin/riak-cs-stanchion"}
                   , {template, "rel/files/riak-cs-storage", "bin/riak-cs-storage"}
                   , {template, "rel/files/riak-cs-supercluster", "bin/riak-cs-supercluster"}
                   , {copy, "rel/files/cert.pem", "etc/cert.pem"}
                   , {copy, "rel/files/key.pem", "etc/key.pem"}
                   ]
         }
       , {generate_start_script, true}
       , {extended_start_script, true}
       ]
}.

{profiles, [ {rel, [ {relx, [ {overlay_vars, "rel/vars.config"}
                            ]
                     }
                   ]
             }
           , {dev, [ {relx, [ {dev_mode, true}
                            ]
                     }
                   ]
             }
           , {rpm, [ {relx, [ {overlay_vars, "rel/pkg/rpm/vars.config"},
                              {overlay, [ {template, "rel/files/riak_cs", "usr/sbin/riak_cs"}
                                        , {template, "rel/pkg/rpm/init.script", "etc/init.d/init.script"}
                                        ]
                              }
                            ]
                     }
                   ]
             }
           , {deb, [ {relx, [ {overlay_vars, "debian/vars.config"}
                            , {overlay, [ {template, "rel/files/riak_cs", "usr/bin/riak_cs"}
                                        ]
                              }
                            ]
                     }
                   ]
             }
           ]
}.


{cuttlefish, [ {file_name, "riak-cs.conf"}
             , {disable_bin_scripts, true}
             , {schema_discovery, true}
             , {schema_order, [ riak_cs
                              , erlang_vm
                              ]}
             ]
}.


{overrides,
 [ {del, xmerl, [{erl_opts, [warnings_as_errors]}]}
 , {del, meck, [{erl_opts, [warnings_as_errors]}]}
 ]
}.

{dialyzer, [{plt_apps, all_deps}]}.

%% {client_test, [
%%     {test_paths, ["client_tests/erlang"]},
%%     {test_output, ".client_test"}
%% ]}.
