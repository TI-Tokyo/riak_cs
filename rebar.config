%% -*- erlang -*-
{minimum_otp_vsn, "22.0"}.

{erl_opts, [ debug_info
           , warnings_as_errors
           ]
}.

{project_plugins, [ {rebar3_cuttlefish, {git, "https://github.com/basho/rebar3_cuttlefish", {tag, "0.2.0"}}}
                  ]
}.

{deps, [ {cuttlefish, ".*", {git, "git://github.com/basho/cuttlefish.git", {tag, "2.0.4"}}}
       , {getopt, ".*", {git, "git://github.com/jcomellas/getopt.git", {tag, "v1.0.2"}}}
       , {webmachine, ".*", {git, "git://github.com/basho/webmachine.git", {tag, "riak_kv-2.9.1"}}}
       , {riakc, ".*", {git, "git://github.com/basho/riak-erlang-client", {tag, "3.0.4"}}}
       , {uuid, ".*", {git, "git://github.com/okeuday/uuid.git", {tag, "v2.0.1"}}}
       , {poolboy, "0.8.*", {git, "git://github.com/basho/poolboy", "riak_kv-3.0.0"}}
       , {exometer_core, ".*", {git, "git://github.com/Feuerlabs/exometer_core", {tag, "v1.5.7"}}}
       , {cluster_info, ".*", {git, "git://github.com/basho/cluster_info", {tag, "2.1.0"}}}
       , {xmerl, ".*", {git, "git://github.com/shino/xmerl", "1b016a05473e086abadbb3c12f63d167fe96c00f"}}
       , {erlcloud, ".*", {git, "git://github.com/basho/erlcloud.git", {tag, "0.4.6"}}}
       , {riak_repl_pb_api,".*", {git,"git://github.com/basho/riak_repl_pb_api.git", {tag, "riak_kv-2.9.1"}}}
       , {riak_cs_multibag,".*", {git,"git://github.com/basho/riak_cs_multibag.git", {tag, "2.1.0p1"}}}
       ]
}.


{eunit_opts, [nowarn_export_all, verbose]}.


{relx, [ {release, {riak_cs, "2.2"},
          [ sasl
          , riak_cs
          ]
         }
       , {dev_mode, false}
       , {include_erts, true}
       , {overlay, [ {template, "rel/files/advanced.config", "etc/advanced.config"}
                   ]
         }
       , {generate_start_script, true}
       , {extended_start_script, true}
       ]
}


{dialyzer, [{plt_apps, all_deps}]}.

{profiles, [ {rel, [ {relx, [ {overlay_vars, "rel/vars.config"}
                            ]
                     }
                   ]
             }
           , {dev, [ {relx, [ {dev_mode, true}
                            ]
                     }
                   ]
             }
           , {rpm, [ {relx, [ {overlay_vars, "rel/pkg/rpm/vars.config"},
                              {overlay, [ {template, "rel/files/riak_cs", "usr/sbin/riak_cs"}
                                        , {template, "rel/pkg/rpm/init.script", "etc/init.d/init.script"}
                                        ]
                              }
                            ]
                     }
                   ]
             }
           , {deb, [ {relx, [ {overlay_vars, "debian/vars.config"}
                            , {overlay, [ {template, "rel/files/riak", "usr/bin/riak"}
                                        ]},
            {extended_start_script_hooks,
                    [{pre_start,
                        [{custom, "hooks/riak_not_running"},
                        {custom, "hooks/check_ulimit"},
                        {custom, "hooks/erl_maxlogsize"}]},
                    {post_start,
                        [wait_for_vm_start,
                            {pid, "/run/riak/riak.pid"},
                            {wait_for_process, riak_core_node_watcher}]}
                    ]}
        ]}
    ]}
]}.


{cuttlefish, [ {file_name, "riak.conf"}
             , {disable_bin_scripts, true}
             , {schema_discovery, true}
             , {schema_order, [ ]}
             ]
}.


%%{cover_enabled, false}.

%%{edoc_opts, [preprocess]}.

%%{xref_checks, []}.
%%{xref_queries,
%% [{"(XC - UC) || (XU - X - B - \"(^riak$|^riak_cs_dummy_reader$|^riak_core_bucket$|^app_helper$|^riakc_pb_socket_fake$|^riak_object$)\" : Mod)", []}]}.

%%{reset_after_eunit, true}.

%% {client_test, [
%%     {test_paths, ["client_tests/erlang"]},
%%     {test_output, ".client_test"}
%% ]}.
%% {riak_test, [
%%     {test_paths, ["riak_test/tests", "riak_test/src",
%%                   "deps/riak_cs_multibag/riak_test/tests",
%%                   "deps/riak_cs_multibag/riak_test/src"]},
%%     {test_output, "riak_test/ebin"}
%% ]}.

